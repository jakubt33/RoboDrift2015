/*
 * main.c
 *
 *  Created on: 17 mar 2015
 *      Author: Kuba
 */

#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>
#include <stdio.h>

#include "communication.h"
#include "io.h"
#include "init.h"

volatile uint8_t dataFromPC=0;
ISR(USART_RXC_vect)
{
	dataFromPC=0;
    dataFromPC=UDR;
    if(dataFromPC&0b1000000){ //if 0b1xxx xxxx
    	ping(0b0111111&dataFromPC); //get how many sensors to ping
    }
    if(dataFromPC&0b01000000){ //if 0bx1xx xxxx
    	startCounter(dataFromPC&0b00001111);
    }

}

int main() {

	init_LED();
	init_USART(MYUBRR);
	init_SPI();

	//sei();
	unsigned char data=0;

	while(1){
		LED_RED_ON;
		_delay_ms(200);
		data = 'k';
		USART_Transmit(data);

		LED_RED_OFF;
		_delay_ms(200);
		data = 'd';
		USART_Transmit(data);
	}
}

